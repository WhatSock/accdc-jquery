/*
ARIA Listbox Generator Module R1.2
Copyright 2010-2013 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(){$A.Listbox=function(w,x){var x=x||{},i=x.grabInstruct||"Press Space to grab",s=x.dropInstruct||"Press Space to drop",v=x.grabMsg||"Grabbed",r=x.dropMsg||"Moved",e=x.cancelDrop||"Grab canceled",j=function(y){return y&&typeof y==="object"&&typeof y.length==="number"&&typeof y.splice==="function"&&!(y.propertyIsEnumerable("length"))},w=typeof w==="string"?$A.getEl(w):w,h=this,n={},o={},q=0,m=x.isMultiselect?[]:"",l=function(y,z){if(y!=h.index||z){$A.query("#"+w.id+" > *",function(A,B){$A.setAttr(B,{tabindex:"-1","aria-selected":"false"})})}if(h.options[y]){$A.setAttr(h.options[y],{tabindex:"0","aria-selected":"true"});h.options[y].scrollIntoView();h.index=y;h.grabbed=p;if(z){h.options[y].focus()}if(!x.isMultiselect){m=h.options[y].id}if(x.callback&&typeof x.callback==="function"){setTimeout(function(){x.callback.apply(h,[h.options[y],h.options])},1)}}},a=function(){m=[];for(id in o){if(o[id]){m.push(id)}}},p="",f=function(){$A.query("#"+w.id+" > *",function(y,z){$A.remAttr(z,"aria-grabbed");$A.setAttr(z,"aria-dropeffect","move")});p=this.id;$A.setAttr(this,"aria-grabbed","true");$A.remAttr(this,"aria-dropeffect");l(n[p]);$A.announce(v)},g=function(z){$A.query("#"+w.id+" > *",function(A,B){$A.remAttr(B,"aria-dropeffect");$A.setAttr(B,"aria-grabbed","false")});if(!z){w.insertBefore(h.options[n[p]],h.options[h.index]);t(true);$A.announce(r)}else{$A.announce(e)}var y=p;p="";l(z?h.index:n[y],z?false:true)},k=function(B){if(B){var A=j(B),z=A?B:[B];for(var y=0;y<z.length;y++){var B=z[y];if(!B||B.nodeType!==1||!B.id){alert("The new item must be a valid DOM node with a unique ID attribute value");return}$A.setAttr(B,{role:"option",tabindex:"-1","aria-selected":"false","aria-label":u(B)});if(x.isSortable||x.isMultiselect){$A.setAttr(B,x.isSortable?"aria-grabbed":"aria-checked","false")}w.appendChild(B);b(B)}t(true)}},c=function(B,C){if(h.options.length){var E=j(B),z=E?B:[B],A=[];for(var y=0;y<z.length;y++){var D=h.options[z[y]];$A.unbind(D,".arialistbox");A.push(w.removeChild(D))}t(true);if(h.index>q){h.index=q}if(h.options.length){l(h.index,C?false:true)}else{m=""}return E?A:A[0]}},d=function(){if(x.isSortable){if(p){g.apply(this)}else{f.apply(this)}}else{if(x.isMultiselect){o[this.id]=o[this.id]?false:true;$A.setAttr(this,"aria-checked",o[this.id]?"true":"false");a();l(h.index)}}},b=function(y){if(!y){$A.bind(w,"focusin.arialistbox",function(){if(x.isSortable){$A.announce(p?s:i,true)}})}$A.bind(y||"#"+w.id+" > *",{"click.arialistbox":function(z){if(x.isSortable){d.apply(this)}else{if(x.isMultiselect){o[this.id]=o[this.id]?false:true;$A.setAttr(this,"aria-checked",o[this.id]?"true":"false");a()}}l(n[this.id])},"keypress.arialistbox":function(A){var z=A.which||A.keyCode;if(z==13){$A.trigger(this,"click")}else{if(z==27&&p){g.apply(this,[true]);A.preventDefault()}else{if(z==32){d.apply(this)}}}},"keydown.arialistbox":function(A){var z=A.which||A.keyCode;if(z==38){if(h.index>0){l(h.index-1,true)}}else{if(z==40){if(h.index<q){l(h.index+1,true)}}else{if(z==35){l(q,true)}else{if(z==36){l(0,true)}else{if(z==46&&x.allowDelete){c(n[this.id])}}}}}}})},u=function(y){return(function(){var z="";$A.query("img",y,function(A,B){if(B.alt){z+=B.alt+" "}});return z})()+(y.innerText||y.textContent)},t=function(y){n=[];o=[];q=0;h.options=$A.query("#"+w.id+" > *",function(z,A){n[A.id]=z;if(x.isMultiselect){o[A.id]=false}q=z;if(!y){$A.setAttr(A,{tabindex:"-1","aria-selected":"false","aria-label":u(A)})}$A.setAttr(A,"aria-posinset",z+1);if(!y&&(x.isSortable||x.isMultiselect)){$A.setAttr(A,x.isSortable?"aria-grabbed":"aria-checked","false")}});$A.query("#"+w.id+" > *",function(z,A){$A.setAttr(A,"aria-setsize",q+1)});if(h.options.length===1){l(0)}};if(x.label){$A.setAttr(w,"aria-label",x.label)}t();b();h.val=function(A){if(typeof A==="number"){l(A)}else{if(A&&typeof A==="string"){l(n[A])}else{if(A&&j(A)&&x.isMultiselect){var y=function(C){for(var B=0;B<A.length;B++){if(A[B]==C){return true}}return false};for(var z=0;z<h.options.length;z++){if((y(h.options[z].id)&&$A.getAttr(h.options[z],"aria-checked")!="true")||(!y(h.options[z].id)&&$A.getAttr(h.options[z],"aria-checked")!="false")||(!A.length&&$A.getAttr(h.options[z],"aria-checked")!="false")){d.apply(h.options[z])}}}else{return m}}}};h.add=k;h.rem=function(y){return !y?null:c(y&&typeof y==="string"?n[y]:y,true)};h.activate=d;h.grabbed=p;h.container=w;h.val(x.defaultIndex||0)}})();