/*
ARIA Listbox Generator Module R1.0
Copyright 2010-2012 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(b){var c="Press Space to grab",e="Press Space to drop",a="Grabbed",f="Moved",d="Grab canceled";$A.Listbox=function(A,h,o,m,C,g,B){var A=typeof A==="string"?$A.getEl(A):A,p=this,u={},v={},x=0,t=g?[]:"",s=function(D,E){if(D!=p.index||E){$A.query("#"+A.id+" > *",function(F,G){$A.setAttr(G,{tabindex:"-1","aria-selected":"false"})})}$A.setAttr(p.options[D],{tabindex:"0","aria-selected":"true"});p.options[D].scrollIntoView();p.index=D;p.grabbed=w;if(E){p.options[D].focus()}if(!g){t=p.options[D].id}if(m&&typeof m==="function"){setTimeout(function(){m.apply(p,[p.options[D],p.options])},1)}},i=function(){t=[];for(id in v){if(v[id]){t.push(id)}}},w="",n=function(){$A.query("#"+A.id+" > *",function(D,E){$A.remAttr(E,"aria-grabbed");$A.setAttr(E,"aria-dropeffect","move")});w=this.id;$A.setAttr(this,"aria-grabbed","true");$A.remAttr(this,"aria-dropeffect");s(u[w]);$A.announce(a)},q=function(E){$A.query("#"+A.id+" > *",function(F,G){$A.remAttr(G,"aria-dropeffect");$A.setAttr(G,"aria-grabbed","false")});if(!E){A.insertBefore(p.options[u[w]],p.options[p.index]);y(true);$A.announce(f)}else{$A.announce(d)}var D=w;w="";s(E?p.index:u[D],E?false:true)},r=function(D){if(!D||D.nodeType!==1||!D.id){alert("The new item must be a valid DOM node with a unique ID attribute value");return}$A.setAttr(D,{role:"option",tabindex:"-1","aria-selected":"false","aria-label":z(D)});if(C||g){$A.setAttr(D,C?"aria-grabbed":"aria-checked","false")}A.appendChild(D);y(true);j(D)},k=function(D,E){A.removeChild(p.options[D]);y(true);if(p.index>x){p.index=x}if(p.options.length){s(p.index,E?false:true)}},l=function(){if(C){if(w){q.apply(this)}else{n.apply(this)}}else{if(g){v[this.id]=v[this.id]?false:true;$A.setAttr(this,"aria-checked",v[this.id]?"true":"false");i();s(p.index)}}},j=function(D){if(!D){$A.bind(A,"focusin.arialistbox",function(){if(C){$A.announce(w?e:c,true)}})}$A.bind(D||"#"+A.id+" > *",{"click.arialistbox":function(E){if(g){v[this.id]=v[this.id]?false:true;$A.setAttr(this,"aria-checked",v[this.id]?"true":"false");i()}s(u[this.id])},"keydown.arialistbox":function(F){var E=F.which||F.keyCode;if(E==38){if(p.index>0){s(p.index-1,true)}}else{if(E==40){if(p.index<x){s(p.index+1,true)}}else{if(E==13){$A.trigger(this,"click")}else{if(E==27&&w){q.apply(this,[true]);F.preventDefault()}else{if(E==32){l.apply(this)}else{if(E==35){s(x,true)}else{if(E==36){s(0,true)}else{if(E==46&&B){k(u[this.id])}}}}}}}}}})},z=function(D){return(function(){var E="";$A.query("img",D,function(F,G){if(G.alt){E+=G.alt+" "}});return E})()+(D.innerText||D.textContent)},y=function(D){u=[];v=[];x=0;p.options=$A.query("#"+A.id+" > *",function(E,F){u[F.id]=E;if(g){v[F.id]=false}x=E;if(!D){$A.setAttr(F,{tabindex:"-1","aria-selected":"false","aria-label":z(F)})}$A.setAttr(F,"aria-posinset",E+1);if(!D&&(C||g)){$A.setAttr(F,C?"aria-grabbed":"aria-checked","false")}});$A.query("#"+A.id+" > *",function(E,F){$A.setAttr(F,"aria-setsize",x+1)})};if(!h&&!$A.getAttr(A,"aria-labelledby")){alert("An explicit form field label is required via the fieldLabel argument, or using aria-labelledby on the element with role=listbox.")}else{if(h){$A.setAttr(A,"aria-label",h)}}y();j();p.val=function(D){if(typeof D==="number"){s(D)}else{if(D&&typeof D==="string"){s(u[D])}else{return t}}};p.add=r;p.rem=function(D){k(D&&typeof D==="string"?u[D]:D,true)};p.activate=l;p.grabbed=w;p.container=A;p.val(o)}})(window);