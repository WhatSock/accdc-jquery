/*
ARIA Listbox Generator Module R2.5
Copyright 2010-2014 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(){$A.Listbox=function(y,z){var z=z||{},i=z.grabInstruct||"Press Space to grab",u=z.dropInstruct||"Press Space to drop",x=z.grabMsg||"Grabbed",t=z.dropMsg||"Moved",e=z.cancelDrop||"Grab canceled",j=function(A){return A&&typeof A==="object"&&typeof A.length==="number"&&typeof A.splice==="function"&&!(A.propertyIsEnumerable("length"))},y=typeof y==="string"?$A.getEl(y):y,h=this;h.index=isNaN(z.defaultIndex)?0:z.defaultIndex;var o={},q={},s=0,n=z.isMultiselect?[]:"",m=function(A,B){if(A!=h.index||B){$A.query("#"+y.id+" > li > a",function(C,D){$A.setAttr(D,{tabindex:"-1"});if(!z.isMultiselect){$A.setAttr(D,{"aria-selected":"false"})}})}if(h.options[A]){$A.setAttr(h.options[A],{tabindex:"0"});if(!z.isMultiselect){$A.setAttr(h.options[A],{"aria-selected":"true"})}h.options[A].scrollIntoView();h.index=A;h.grabbed=r;if(B){h.options[A].focus()}if(!z.isMultiselect){n=h.options[A].id}if(z.callback&&typeof z.callback==="function"){setTimeout(function(){z.callback.apply(h,[h.options[A],h.options])},1)}}},a=function(){n=[];for(id in q){if(q[id]){n.push(id)}}},r="",f=function(){$A.query("#"+y.id+" > li > a",function(A,B){$A.remAttr(B,"aria-grabbed");$A.setAttr(B,"aria-dropeffect","move")});r=this.id;$A.setAttr(this,"aria-grabbed","true");$A.remAttr(this,"aria-dropeffect");m(o[r]);$A.announce(x)},g=function(B){$A.query("#"+y.id+" > li > a",function(C,D){$A.remAttr(D,"aria-dropeffect");$A.setAttr(D,"aria-grabbed","false")});if(!B){y.insertBefore(h.options[o[r]].parentNode,h.options[h.index].parentNode);v(true);$A.announce(t)}else{$A.announce(e)}var A=r;r="";m(B?h.index:o[A],B?false:true)},k=function(F){if(!h.options.length){h.empty=true}if(F){if(r){g.apply(this,[true])}var E=j(F),C=E?F:[F],D=h.options.length;for(var B=0;B<C.length;B++){var F=C[B],A=$A.createEl("li");if(!F||F.nodeType!==1||!F.id){return}$A.setAttr(F,{role:"option",tabindex:"-1","aria-selected":"false","aria-label":w(F)});if(z.isSortable||z.isMultiselect){$A.setAttr(F,z.isSortable?"aria-grabbed":"aria-selected","false")}A.appendChild(F);y.appendChild(A);b(F)}v(true);if(D<h.options.length){m(D)}}},c=function(E,F){if(h.options.length){if(r){g.apply(this,[true])}var H=j(E),B=H?E:[E],D=[];for(var A=0;A<B.length;A++){var G=h.options[B[A]];$A.unbind(G,".arialistbox");var C=G.parentNode;D.push(C.removeChild(G));y.removeChild(C)}n=z.isMultiselect?[]:"";v();if(h.index>s){h.index=s}if(h.options.length){m(h.options[h.index]?h.index:0,F?false:true)}return H?D:D[0]}},d=function(){if(z.isSortable){if(r){g.apply(this)}else{f.apply(this)}}else{if(z.isMultiselect){q[this.id]=q[this.id]?false:true;$A.setAttr(this,"aria-selected",q[this.id]?"true":"false");a();m(h.index)}}},b=function(A){if(!A){$A.bind(y,"focusin.arialistbox",function(){if(z.isSortable){$A.announce(r?u:i,true)}})}$A.bind(A||"#"+y.id+" > li > a",{"click.arialistbox":function(B){B.preventDefault();if(z.isSortable){m(o[this.id]);d.apply(this)}else{if(z.isMultiselect){q[this.id]=q[this.id]?false:true;$A.setAttr(this,"aria-selected",q[this.id]?"true":"false");a()}}m(o[this.id])},"keypress.arialistbox":function(C){var B=C.which||C.keyCode;if(B==13){$A.trigger(this,"click")}else{if(B==27&&r){g.apply(this,[true]);C.preventDefault()}else{if(B==32){d.apply(this);C.preventDefault()}}}},"keydown.arialistbox":function(D){var B=D.which||D.keyCode;if(B==38){D.preventDefault();if(h.index>0){m(h.index-1,true)}}else{if(B==40){D.preventDefault();if(h.index<s){m(h.index+1,true)}}else{if(B==35){D.preventDefault();m(s,true)}else{if(B==36){D.preventDefault();m(0,true)}else{if(B==33){D.preventDefault();var C=h.index-parseInt((s*(s>=20?0.1:0.5)));if(h.index!=C){m(C>0?C:0,true)}}else{if(B==34){D.preventDefault();var C=h.index+parseInt((s*(s>=20?0.1:0.5)));if(h.index!=C){m(C<s?C:s,true)}}else{if(B==46&&z.allowDelete){D.preventDefault();c(o[this.id])}else{if((B>=48&&B<=57)||(B>=65&&B<=90)){p(String.fromCharCode(B));D.preventDefault()}}}}}}}}}})},w=function(A){return(function(){var B="";$A.query("img",A,function(C,D){if(D.alt){B+=D.alt+" "}});return B})()+(A.innerText||A.textContent)},l=[],p=function(A){for(var B=h.index+1;B<=s;B++){if(A.toLowerCase()==l[B].replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase()){m(B,true);return}}for(var B=0;B<h.index;B++){if(A.toLowerCase()==l[B].replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase()){m(B,true);return}}},v=function(B){o={};l=[];q={};s=0;var A=[];h.options=$A.query("#"+y.id+" > li > a",function(C,D){o[D.id]=C;l.push($A.getText(D));if(z.isMultiselect){q[D.id]=false}s=C;if(!B){$A.setAttr(D,{tabindex:"-1","aria-selected":"false","aria-label":w(D)})}$A.setAttr(D,"aria-posinset",C+1);if(!B&&(z.isSortable||z.isMultiselect)){$A.setAttr(D,z.isSortable?"aria-grabbed":"aria-selected","false")}if(D.id){A.push(D.id)}});if(A.length){$A.setAttr(y,"aria-owns",A.join(" "))}$A.query("#"+y.id+" > li > a",function(C,D){$A.setAttr(D,"aria-setsize",s+1)});if(h.options.length===1||(h.empty&&h.options.length>0)){m(0)}h.empty=false};if(z.isMultiselect){$A.setAttr(y,"aria-multiselectable","true")}if(z.label){$A.setAttr(y,"aria-label",z.label)}v();b();h.val=function(C){if(typeof C==="number"){m(C)}else{if(C&&typeof C==="string"){m(o[C])}else{if(C&&j(C)&&z.isMultiselect){var A=function(E){for(var D=0;D<C.length;D++){if(C[D]==E){return true}}return false};for(var B=0;B<h.options.length;B++){if((A(h.options[B].id)&&$A.getAttr(h.options[B],"aria-selected")!="true")||(!A(h.options[B].id)&&$A.getAttr(h.options[B],"aria-selected")!="false")||(!C.length&&$A.getAttr(h.options[B],"aria-selected")!="false")){d.apply(h.options[B])}}}else{return n}}}};h.add=k;h.rem=function(C){var E=j(C),B=E?C:[C],D=[];for(var A=0;A<B.length;A++){D.push(!B[A]?null:c(B[A]&&typeof B[A]==="string"?o[B[A]]:B[A],true))}return E?D:D[0]};h.activate=d;h.grabbed=r;h.container=y;h.val(h.index)}})();