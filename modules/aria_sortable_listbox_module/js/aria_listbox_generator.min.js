/*
ARIA Listbox Generator Module R1.1
Copyright 2010-2013 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(){$A.Listbox=function(v,w){var w=w||{},h=w.grabInstruct||"Press Space to grab",r=w.dropInstruct||"Press Space to drop",u=w.grabMsg||"Grabbed",q=w.dropMsg||"Moved",e=w.cancelDrop||"Grab canceled",v=typeof v==="string"?$A.getEl(v):v,g=this,m={},n={},p=0,l=w.isMultiselect?[]:"",k=function(x,y){if(x!=g.index||y){$A.query("#"+v.id+" > *",function(z,A){$A.setAttr(A,{tabindex:"-1","aria-selected":"false"})})}$A.setAttr(g.options[x],{tabindex:"0","aria-selected":"true"});g.options[x].scrollIntoView();g.index=x;g.grabbed=o;if(y){g.options[x].focus()}if(!w.isMultiselect){l=g.options[x].id}if(w.callback&&typeof w.callback==="function"){setTimeout(function(){w.callback.apply(g,[g.options[x],g.options])},1)}},a=function(){l=[];for(id in n){if(n[id]){l.push(id)}}},o="",f=function(){$A.query("#"+v.id+" > *",function(x,y){$A.remAttr(y,"aria-grabbed");$A.setAttr(y,"aria-dropeffect","move")});o=this.id;$A.setAttr(this,"aria-grabbed","true");$A.remAttr(this,"aria-dropeffect");k(m[o]);$A.announce(u)},i=function(y){$A.query("#"+v.id+" > *",function(z,A){$A.remAttr(A,"aria-dropeffect");$A.setAttr(A,"aria-grabbed","false")});if(!y){v.insertBefore(g.options[m[o]],g.options[g.index]);s(true);$A.announce(q)}else{$A.announce(e)}var x=o;o="";k(y?g.index:m[x],y?false:true)},j=function(x){if(!x||x.nodeType!==1||!x.id){alert("The new item must be a valid DOM node with a unique ID attribute value");return}$A.setAttr(x,{role:"option",tabindex:"-1","aria-selected":"false","aria-label":t(x)});if(w.isSortable||w.isMultiselect){$A.setAttr(x,w.isSortable?"aria-grabbed":"aria-checked","false")}v.appendChild(x);s(true);b(x)},c=function(x,y){var z=v.removeChild(g.options[x]);s(true);if(g.index>p){g.index=p}if(g.options.length){k(g.index,y?false:true)}$A.unbind(z,".arialistbox");return z},d=function(){if(w.isSortable){if(o){i.apply(this)}else{f.apply(this)}}else{if(w.isMultiselect){n[this.id]=n[this.id]?false:true;$A.setAttr(this,"aria-checked",n[this.id]?"true":"false");a();k(g.index)}}},b=function(x){if(!x){$A.bind(v,"focusin.arialistbox",function(){if(w.isSortable){$A.announce(o?r:h,true)}})}$A.bind(x||"#"+v.id+" > *",{"click.arialistbox":function(y){if(w.isMultiselect){n[this.id]=n[this.id]?false:true;$A.setAttr(this,"aria-checked",n[this.id]?"true":"false");a()}k(m[this.id])},"keypress.arialistbox":function(z){var y=z.which||z.keyCode;if(y==13){$A.trigger(this,"click")}else{if(y==27&&o){i.apply(this,[true]);z.preventDefault()}else{if(y==32){d.apply(this)}}}},"keydown.arialistbox":function(z){var y=z.which||z.keyCode;if(y==38){if(g.index>0){k(g.index-1,true)}}else{if(y==40){if(g.index<p){k(g.index+1,true)}}else{if(y==35){k(p,true)}else{if(y==36){k(0,true)}else{if(y==46&&w.allowDelete){c(m[this.id])}}}}}}})},t=function(x){return(function(){var y="";$A.query("img",x,function(z,A){if(A.alt){y+=A.alt+" "}});return y})()+(x.innerText||x.textContent)},s=function(x){m=[];n=[];p=0;g.options=$A.query("#"+v.id+" > *",function(y,z){m[z.id]=y;if(w.isMultiselect){n[z.id]=false}p=y;if(!x){$A.setAttr(z,{tabindex:"-1","aria-selected":"false","aria-label":t(z)})}$A.setAttr(z,"aria-posinset",y+1);if(!x&&(w.isSortable||w.isMultiselect)){$A.setAttr(z,w.isSortable?"aria-grabbed":"aria-checked","false")}});$A.query("#"+v.id+" > *",function(y,z){$A.setAttr(z,"aria-setsize",p+1)})};if(w.label){$A.setAttr(v,"aria-label",w.label)}s();b();g.val=function(x){if(typeof x==="number"){k(x)}else{if(x&&typeof x==="string"){k(m[x])}else{return l}}};g.add=j;g.rem=function(x){c(x&&typeof x==="string"?m[x]:x,true)};g.activate=d;g.grabbed=o;g.container=v;g.val(w.defaultIndex||0)}})();