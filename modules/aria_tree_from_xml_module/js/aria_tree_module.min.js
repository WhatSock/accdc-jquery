/*
ARIA Tree From XML Module R2.1
Copyright 2010-2013 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(){$A.setTree=function(e){var e=e||{},c=e.title,k=e.container,p=e.treeTag||"ul",m=e.treeClass||"branch",j=e.dividerTag||"li",b=e.treeItemTag||"a",g=e.treeItemClass||"leaf",f=e.selectClass||"selected",o=xmlDoc=null,i=function(q){q.tree={node:$A.createEl(p),childNodes:[],ids:[]};for(var t=0;t<q.xmlNodes.length;t++){var w=q.xmlNodes[t];if(!(w.nodeType!==1||w.nodeName=="#text")){var v=$A.createEl(j),u=$A.createEl(b);if(u.nodeName.toLowerCase()=="a"){$A.setAttr(u,"href","#")}$A.setAttr(u,"id",w.attributes.getNamedItem("id").value);q.tree.ids.push(u.id);var r=false;for(var s=0;s<w.childNodes.length;s++){if(!(w.childNodes[s].nodeType!==1||w.childNodes[s].nodeName=="#text")){r=true}}if(r){$A.addClass(u,m)}else{$A.addClass(u,g)}u.innerHTML="<span>"+w.attributes.getNamedItem("name").value+"</span>";$A.setAttr(u,"aria-label",$A.getText(u));v.appendChild(u);q.tree.node.appendChild(v);q.tree.childNodes.push(u)}}if(q.tree.ids.length){$A.setAttr(q.tree.node,"aria-owns",q.tree.ids.join(" "))}},d=function(s,q){var q=q||"folder",v=s.tree.node,u=s.tree.childNodes;if(s.ariaLevel===1){$A.setAttr(v,{role:"tree","aria-label":c})}else{var w="aria"+$A.genId();$A.setAttr(v,{role:"group",id:w});$A.setAttr(o,"aria-owns",w)}for(var t=0;t<u.length;t++){var r=u[t];$A.setAttr(r,{role:"treeitem","aria-setsize":u.length,"aria-posinset":t+1,"aria-level":s.ariaLevel});if(!t&&s.ariaLevel===1){$A.setAttr(r,{tabindex:"0","aria-selected":"true"})}else{$A.setAttr(r,{tabindex:"-1","aria-selected":"false"})}if($A.hasClass(r,q)){$A.setAttr(r,"aria-expanded","false")}$A.bind(r,{focustreeitem:function(x){$A.query("."+f,s.top.accDCObj,function(y,z){$A.setAttr(z,{"aria-selected":"false",tabindex:"-1"});$A.remClass(z,f)});if(o){s.triggerObj=o}o=this;$A.addClass(o,f);$A.setAttr(o,{tabindex:"0","aria-selected":"true"}).focus()},clicktreeitem:function(x){if(!$A.hasClass(this,f)){$A.trigger(this,"focustreeitem")}else{if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="false"){$A.setAttr(this,"aria-expanded","true");$A.reg[this.id].open()}else{if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="true"){$A.setAttr(this,"aria-expanded","false");$A.reg[this.id].close()}}}x.preventDefault()},focus:function(x){if(!$A.hasClass(this,f)){$A.trigger(this,"focustreeitem")}},click:function(x){x.preventDefault();$A.trigger(this,"clicktreeitem")},keypress:function(y){var x=y.which||y.keyCode;if(x==13||x==32){$A.trigger(this,"click");y.preventDefault()}},keydown:function(I){var E=I.which||I.keyCode;if(E>=35&&E<=40){if(E==35){var C=s;while(C.parent){C=C.parent}var J=C.tree.childNodes;while($A.hasClass(J[J.length-1],m)&&$A.getAttr(J[J.length-1],"aria-expanded")=="true"){J=$A.reg[J[J.length-1].id].tree.childNodes}if(J[J.length-1]!=this){$A.trigger(J[J.length-1],"focustreeitem")}}else{if(E==36){var C=s;while(C.parent){C=C.parent}$A.trigger(C.tree.childNodes[0],"focustreeitem")}else{if(E==37){if(s.parent&&(($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="false")||$A.hasClass(this,g))){var J=s.parent.tree.childNodes,D=null;for(var H=0;H<J.length;H++){if(J[H].id==s.id){D=J[H];break}}if(D){$A.trigger(D,"focustreeitem")}}else{if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="true"){$A.setAttr(this,"aria-expanded","false");$A.reg[this.id].close()}}}else{if(E==39){if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="true"){var z=$A.reg[this.id].tree.childNodes[0];$A.trigger(z,"focustreeitem")}else{$A.trigger(this,"clicktreeitem")}}else{if(E==38){if(s.parent&&this==u[0]){var J=s.parent.tree.childNodes,D=null;for(var H=0;H<J.length;H++){if(J[H].id==s.id){D=J[H];break}}if(D){$A.trigger(D,"focustreeitem")}}else{if(this!=u[0]){var F=$A.inArray(this,u),K=u[F-1];while($A.hasClass(K,m)&&$A.getAttr(K,"aria-expanded")=="true"){var J=$A.reg[K.id].tree.childNodes;K=J[J.length-1]}if(K){$A.trigger(K,"focustreeitem")}}}}else{if(E==40){if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="true"){var D=$A.reg[this.id].tree.childNodes[0];if(D){$A.trigger(D,"focustreeitem")}}else{var F=$A.inArray(this,u);if(F<(u.length-1)){$A.trigger(u[F+1],"focustreeitem")}else{var x=s.id,C=s.parent,D=null;while(C){var J=C.tree.childNodes;for(var G=0;G<J.length;G++){if(J[G].id==x&&G<(J.length-1)){D=J[G+1];break}}if(D){$A.trigger(D,"focustreeitem");break}x=C.id;C=C.parent}}}}}}}}}I.preventDefault()}else{if((E>=48&&E<=57)||(E>=65&&E<=90)){var B=function(y){if(A===-1){return}for(var L=A+1;L<=s.tree.childNodes.length;L++){if(y.toLowerCase()==$A.getText(s.tree.childNodes[L]).replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase()){$A.trigger(s.tree.childNodes[L],"focustreeitem");return}}for(var L=0;L<A;L++){if(y.toLowerCase()==$A.getText(s.tree.childNodes[L]).replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase()){$A.trigger(s.tree.childNodes[L],"focustreeitem");return}}},A=$A.inArray(this,s.tree.childNodes);B(String.fromCharCode(E));I.preventDefault()}}}})}},l=function(q){d(q,m);var t=[];for(var r=0;r<q.tree.childNodes.length;r++){var s=q.tree.childNodes[r];if($A.hasClass(s,m)){t.push({id:s.id,role:$A.getText(s),isStatic:s.parentNode,append:true,runBefore:function(u){u.xmlNodes=$A.query("*[id="+u.id+"] > *",xmlDoc);i(u);u.source=u.tree.node},runAfter:l,ariaLevel:q.ariaLevel+1})}}if(e.bind&&e.callback&&typeof e.callback==="function"){$A.bind(q.tree.childNodes,e.bind,function(u){e.callback.apply(this,[u,q])})}$A(q,t,n)},n={showHiddenBounds:false,allowMultiple:true,className:e.topClass||"TreeView"},h=e.id||$A.genId();$A([{id:h,role:"TreeView",autoStart:true,isStatic:k,allowReopen:true,mode:6,ajaxOptions:{url:e.path,dataType:"text"},hSuccess:function(s,t,u,r,q){xmlDoc=q.xmlDocument=a(t);q.xmlTop=xmlDoc.documentElement;q.xmlNodes=$A.query(q.xmlTop.nodeName+" > *",xmlDoc);i(q);q.content=q.tree.node},runAfter:l,runOnceAfter:function(q){q.triggerObj=q.tree.childNodes[0]},ariaLevel:1}],n,true);return h};var a=function(b){if(!b){b=""}var c;if(window.DOMParser){var d=new DOMParser();c=d.parseFromString(b,"text/xml")}else{c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML(b)}return c}})();