/* !
ARIA Tree From XML Module R1.0
Copyright 2010-2013 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(b){$A.setTree=function(f){var f=f||{},d=f.title,k=f.container,g={bind:f.bind,def:f.callback},p=f.treeTag||"ul",m=f.treeClass||"branch",c=f.treeItemTag||"li",h=f.treeItemClass||"leaf",o=xmlDoc=null,j=function(q){q.tree={node:$A.createEl(p),childNodes:[]};for(var r=0;r<q.xmlNodes.length;r++){var u=q.xmlNodes[r],t=$A.createEl(c),s=$A.createEl("div");$A.setAttr(s,"id",u.attributes.getNamedItem("id").nodeValue);if(u.childNodes.length){$A.addClass(s,m)}else{$A.addClass(s,h)}s.innerHTML=u.attributes.getNamedItem("name").nodeValue;$A.setAttr(s,"aria-label",$A.getText(s));t.appendChild(s);q.tree.node.appendChild(t);q.tree.childNodes.push(s)}},e=function(s,q){var q=q||"folder",v=s.tree.node,u=s.tree.childNodes;if(s.ariaLevel===1){$A.setAttr(v,{role:"tree","aria-label":d})}else{var w="aria"+$A.genId();$A.setAttr(v,{role:"group",id:w});$A.setAttr(o,"aria-owns",w)}for(var t=0;t<u.length;t++){var r=u[t];$A.setAttr(r,"role","treeitem");$A.setAttr(r,"aria-setsize",u.length);$A.setAttr(r,"aria-posinset",t+1);$A.setAttr(r,"aria-level",s.ariaLevel);if(s.ariaLevel===1){$A.setAttr(r,"tabindex","0")}else{$A.setAttr(r,"tabindex","-1")}if($A.hasClass(r,q)){$A.setAttr(r,"aria-expanded","false")}$A.bind(r,{focus:function(x){if(o){$A.setAttr(o,"aria-selected","false");$A.setAttr(o,"tabindex","-1");$A.remClass(o,"selected");s.triggerObj=o}o=this;$A.setAttr(o,"tabindex","0");$A.setAttr(o,"aria-selected","true");$A.addClass(o,"selected")},click:function(x){if(!$A.hasClass(this,"selected")){$A.trigger(this,"focus")}else{if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="false"){$A.setAttr(this,"aria-expanded","true");$A.reg[this.id].open()}else{if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="true"){$A.setAttr(this,"aria-expanded","false");$A.reg[this.id].close()}}}x.preventDefault()},keypress:function(y){var x=y.which||y.keyCode;if(x==13){$A.trigger(this,"click");y.preventDefault()}},keydown:function(G){var C=G.which||G.keyCode;if(C>=35&&C<=40){if(C==35){var A=s;while(A.parent){A=A.parent}var H=A.tree.childNodes;while($A.hasClass(H[H.length-1],m)&&$A.getAttr(H[H.length-1],"aria-expanded")=="true"){H=$A.reg[H[H.length-1].id].tree.childNodes}if(H[H.length-1]!=this){$A.trigger(H[H.length-1],"focus")}}else{if(C==36){var A=s;while(A.parent){A=A.parent}$A.trigger(A.tree.childNodes[0],"focus")}else{if(C==37){if(s.parent&&(($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="false")||$A.hasClass(this,h))){var H=s.parent.tree.childNodes,B=null;for(var F=0;F<H.length;F++){if(H[F].id==s.id){B=H[F];break}}if(B){$A.trigger(B,"focus")}}else{if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="true"){$A.setAttr(this,"aria-expanded","false");$A.reg[this.id].close()}}}else{if(C==39){if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="true"){var z=$A.reg[this.id].tree.childNodes[0];$A.trigger(z,"focus")}else{$A.trigger(this,"click")}}else{if(C==38){if(s.parent&&this==u[0]){var H=s.parent.tree.childNodes,B=null;for(var F=0;F<H.length;F++){if(H[F].id==s.id){B=H[F];break}}if(B){$A.trigger(B,"focus")}}else{if(this!=u[0]){var D=$A.inArray(this,u),I=u[D-1];while($A.hasClass(I,m)&&$A.getAttr(I,"aria-expanded")=="true"){var H=$A.reg[I.id].tree.childNodes;I=H[H.length-1]}if(I){$A.trigger(I,"focus")}}}}else{if(C==40){if($A.hasClass(this,m)&&$A.getAttr(this,"aria-expanded")=="true"){var B=$A.reg[this.id].tree.childNodes[0];if(B){$A.trigger(B,"focus")}}else{var D=$A.inArray(this,u);if(D<(u.length-1)){$A.trigger(u[D+1],"focus")}else{var x=s.id,A=s.parent,B=null;while(A){var H=A.tree.childNodes;for(var E=0;E<H.length;E++){if(H[E].id==x&&E<(H.length-1)){B=H[E+1];break}}if(B){$A.trigger(B,"focus");break}x=A.id;A=A.parent}}}}}}}}}G.preventDefault()}}})}},l=function(q){e(q,m);var t=[];for(var r=0;r<q.tree.childNodes.length;r++){var s=q.tree.childNodes[r];if($A.hasClass(s,m)){t.push({id:s.id,role:$A.getText(s),trigger:s,bind:"custom",isStatic:s.parentNode,append:true,runBefore:function(u){u.xmlNodes=$A.query("*[id="+u.id+"] > *",xmlDoc);j(u);u.source=u.tree.node},runAfter:l,ariaLevel:q.ariaLevel+1})}$A.bind(s,g.bind,function(u){if(g.def&&typeof g.def==="function"){g.def.apply(this,[u,q])}})}$A(q,t,n)},n={showHiddenBounds:false,allowMultiple:true,className:f.topClass||"TreeView"},i=f.id||$A.genId();$A([{id:i,role:"TreeView",autoStart:true,isStatic:k,allowReopen:true,mode:6,ajaxOptions:{url:f.path,dataType:"text"},hSuccess:function(s,t,u,r,q){xmlDoc=a(t);q.xmlTop=xmlDoc.documentElement;q.xmlNodes=$A.query(q.xmlTop.nodeName+" > *",xmlDoc);j(q);q.content=q.tree.node},runAfter:l,runOnceAfter:function(q){q.triggerObj=q.tree.childNodes[0]},ariaLevel:1}],n,true);return i};var a=function(c){if(!c){c=""}var d;if(b.DOMParser){var e=new DOMParser();d=e.parseFromString(c,"text/xml")}else{d=new ActiveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(c)}return d}})(window);