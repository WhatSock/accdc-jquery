/*
ARIA Menu Module R2.0
Copyright 2010-2013 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(){var b={};$A.setMenu=function(e,n,c,k,l,d,f){var j=l?$A.getEl(n):$A.createEl("div"),m=k||function(){},f=f||{},i=function(o){o.mNode=$A.query((f.menuTag||"ul")+"."+(f.menuClass||"menu"),o.containerDiv)[0],ids=[];var s=parseInt($A.getAttr(o.mNode,"data-offsetleft")),p=parseInt($A.getAttr(o.mNode,"data-offsettop")),u=false,t=$A.getAttr(o.mNode,"data-horizontal"),q=parseInt($A.getAttr(o.mNode,"data-autoposition"));if(!t){t=f.horizontal?"true":"false"}o.hor=t==="true"?true:false;if(!isNaN(s)){o.offsetLeft+=s;u=true}if(!isNaN(p)){o.offsetTop+=p;u=true}if(!isNaN(q)){o.autoPosition=q;u=true}if(u){o.setPosition()}a((f.menuTag||"ul")+"."+(f.menuClass||"menu"),(f.menuTag||"ul")+"."+(f.menuClass||"menu")+" "+(f.itemTag||"li"),o,f);var r=[];$A.query(((f.menuTag||"ul")+"."+(f.menuClass||"menu")+" "+(f.itemTag||"li"))+"."+(f.folderClass||"submenu"),o.containerDiv,function(v,w){r.push({id:o.id+w.id,role:o.role,accStart:o.accStart,accEnd:o.accEnd,bind:"click",isTab:true,tabRole:"",tabState:f.openState||"Open",trigger:w,handler:m,topLvlId:o.topLvlId+w.id,source:b[o.topLvlId+w.id],autoPosition:isNaN(f.autoPosition)?3:f.autoPosition,runBefore:function(y){y.offsetLeft=typeof f.offsetLeft==="number"?f.offsetLeft:(typeof f.offsetLeft==="function"?f.offsetLeft(y):(!f.horizontal&&y.parent?-(y.parent.accDCObj.offsetWidth/2):0));y.offsetTop=typeof f.offsetTop==="number"?f.offsetTop:(typeof f.offsetTop==="function"?f.offsetTop(y):(!f.horizontal?-y.triggerObj.offsetHeight:0))},runDuring:function(y){$A.setAttr(y.accDCObj,"role","application")},runAfter:i,runBeforeClose:g,cssObj:{position:(f.overrides&&f.overrides.cssObj&&f.overrides.cssObj.position)||"relative",zIndex:o.cssObj.zIndex+1},className:f.containerClass||"menu",ariaLevel:o.ariaLevel+1,tabOut:o.tabOut,allowCascade:true});$A.setAttr(w,"aria-haspopup","true");if($A.reg[o.id+w.id]){var x=$A.reg[o.id+w.id];if(x.fn.sraCSSObj){x.fn.sraCSSObj.parentNode.removeChild(x.fn.sraCSSObj)}x.returnFocus=false;x.close();x.returnFocus=true}ids.push(w.id)});$A(o,r,f.overrides);$A.query(((f.menuTag||"ul")+"."+(f.menuClass||"menu")+" "+(f.itemTag||"li"))+"."+(f.linkClass||"link"),o.containerDiv,function(v,w){$A.bind(w,"click",function(x){o.top.close();if(o.handler&&typeof o.handler==="function"){return o.handler.apply(this,[x,o])}});ids.push(w.id)});if(ids.length){$A.setAttr(o.mNode,"aria-owns",ids.join(" "))}},g=function(o){if(o.children.length){for(var p=0;p<o.children.length;p++){o.children[p].close()}}if(o.iNodes&&o.iNodes.length){$A.unbind(o.iNodes,"click keypress keyup")}},h=function(){$A.query((f.menuTag||"ul")+"."+(f.menuClass||"menu"),j,function(p,q){b[q.id]=q.parentNode.removeChild(q)||b[q.id]});if($A.reg[c]){var o=$A.reg[c];if(o.fn.sraCSSObj){o.fn.sraCSSObj.parentNode.removeChild(o.fn.sraCSSObj)}o.returnFocus=false;o.close();o.returnFocus=true}$A([{id:c,role:f.role||"Menu",accStart:f.accStart||"Start",accEnd:f.accEnd||"End",controlType:"MenuControl",bind:"click",isToggle:true,toggleRole:"",toggleState:f.openState||"Open",trigger:e,handler:m,topLvlId:c,source:b[c],autoPosition:isNaN(f.autoPosition)?3:f.autoPosition,runOnceBefore:function(p){$A.bind(p.triggerObj,"focus",function(q){if(p.loaded&&!("ontouchstart" in window)){p.close()}})},runBefore:function(p){$A.find("*",function(q){if(q.controlType&&q.controlType=="MenuControl"&&q.loaded){q.close()}});p.offsetLeft=typeof f.offsetLeft==="number"?f.offsetLeft:(typeof f.offsetLeft==="function"?f.offsetLeft(p):(!f.horizontal&&p.parent?-(p.parent.accDCObj.offsetWidth/2):0));p.offsetTop=typeof f.offsetTop==="number"?f.offsetTop:(typeof f.offsetTop==="function"?f.offsetTop(p):(!f.horizontal?-p.triggerObj.offsetHeight:0))},runDuring:function(p){$A.setAttr(p.accDCObj,"role","application")},runAfter:i,runBeforeClose:g,cssObj:{position:(f.overrides&&f.overrides.cssObj&&f.overrides.cssObj.position)||"absolute",zIndex:(f.overrides&&f.overrides.cssObj&&f.overrides.cssObj.zIndex)||1},className:f.containerClass||"menu",ariaLevel:f.ariaLevel||3,tabOut:function(q,p){if(!("ontouchstart" in window)){p.top.close()}},allowCascade:true}],f.overrides,true)};if(l){h()}else{$A.load(j,n,h)}$A.setAttr($A.query(e,d)[0],"aria-haspopup","true")};var a=function(i,h,c,g){var f=0;$A.query(i,c.containerDiv,function(j,k){$A.setAttr(k,"role","menu")});var e=function(){var k=this;for(var m=d.length-1;m>=0;m--){if(d[m].id==k.id){f=m}$A.setAttr(d[m],{tabindex:-1,"aria-selected":"false"})}$A.setAttr(k,{tabindex:"0","aria-selected":"true"}).focus()},d=c.iNodes=$A.query(h,c.containerDiv,function(j,k){$A.setAttr(k,{role:"menuitem",tabindex:-1});$A.bind(k,{keypress:function(m){var l=m.which||m.keyCode;if(l==27){c.close();m.preventDefault()}else{if(l==13){$A.trigger(this,"click");m.preventDefault()}}},keyup:function(m){var l=m.which||m.keyCode;if(l>=37&&l<=40){m.preventDefault();if(c!=c.top&&((l==37&&!c.hor)||(l==38&&c.hor))){c.close()}else{if((l==39&&!c.hor)||(l==40&&c.hor)){if($A.hasClass(this,g.folderClass||"submenu")){$A.trigger(this,"click")}}else{if((l==38&&!c.hor)||(l==37&&c.hor)){f=f<=0?d.length-1:f-1}else{if((l==40&&!c.hor)||(l==39&&c.hor)){f=f>=(d.length-1)?0:f+1}}}}if(((l==38||l==40)&&!c.hor)||((l==37||l==39)&&c.hor)){if(!d[f]||d[f].nodeType!==1){f=0}if(d.length){e.apply(d[f])}}}}})});e.apply(d[f])};$A.bind(window,"resize",function(){$A.find("*",function(c){if(c.controlType&&c.controlType=="MenuControl"&&c.loaded){c.close()}})})})();