/*
ARIA Menu Module R2.8
Copyright 2010-2015 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
	*/
(function(){var d={},g=null,c=null;$A.setMenu=function(k,u,i,r,s,j,l){var q=s?$A.getEl(u):$A.createEl("div"),t=r||function(){},l=l||{},p=function(v){c.menuOpen=true;c.currentMenu=v.top;if("ontouchstart" in window){$A.bind(v.accDCObj,"touchstart",function(C){c.pass=true})}v.mNode=$A.query((l.menuTag||"ul")+"."+(l.menuClass||"menu"),v.containerDiv)[0],ids=[];var z=parseInt($A.getAttr(v.mNode,"data-offsetleft")),w=parseInt($A.getAttr(v.mNode,"data-offsettop")),B=false,A=$A.getAttr(v.mNode,"data-horizontal"),x=parseInt($A.getAttr(v.mNode,"data-autoposition"));if(!A){A=l.horizontal?"true":"false"}v.hor=A==="true"?true:false;if(!isNaN(z)){v.offsetLeft+=z;B=true}if(!isNaN(w)){v.offsetTop+=w;B=true}if(!isNaN(x)){v.autoPosition=x;B=true}if(B){v.setPosition()}b((l.menuTag||"ul")+"."+(l.menuClass||"menu"),(l.menuTag||"ul")+"."+(l.menuClass||"menu")+" "+(l.itemTag||"li"),v,l);var y=[];$A.query(((l.menuTag||"ul")+"."+(l.menuClass||"menu")+" "+(l.itemTag||"li"))+"."+(l.folderClass||"submenu"),v.containerDiv,function(C,D){y.push({id:v.id+D.id,role:v.role,accStart:v.accStart,accEnd:v.accEnd,bind:"popupsubmenu",isTab:true,tabRole:"",tabState:l.openState||"",trigger:D,handler:t,topLvlId:v.topLvlId+D.id,source:d[v.topLvlId+D.id],autoPosition:isNaN(l.autoPosition)?3:l.autoPosition,runBefore:function(F){F.offsetLeft=typeof l.offsetLeft==="number"?l.offsetLeft:(typeof l.offsetLeft==="function"?l.offsetLeft(F):(!l.horizontal&&F.parent?-(F.parent.accDCObj.offsetWidth/2):0));F.offsetTop=typeof l.offsetTop==="number"?l.offsetTop:(typeof l.offsetTop==="function"?l.offsetTop(F):(!l.horizontal?-F.triggerObj.offsetHeight:0))},runDuring:function(F){$A.setAttr(F.accDCObj,"role","application");if(F.showHiddenBounds){F.fn.sraStart.innerHTML=F.fn.sraEnd.innerHTML="";$A.setAttr(F.fn.sraStart,"aria-hidden","true");$A.setAttr(F.fn.sraEnd,"aria-hidden","true")}},runAfter:p,runBeforeClose:n,cssObj:{position:(l.overrides&&l.overrides.cssObj&&l.overrides.cssObj.position)||"relative",zIndex:v.cssObj.zIndex+1},className:l.containerClass||"menu",ariaLevel:v.ariaLevel+1,tabOut:v.tabOut,allowCascade:true});$A.setAttr(D,"aria-haspopup","true");if($A.reg[v.id+D.id]){var E=$A.reg[v.id+D.id];if(E.fn.sraCSSObj){E.fn.sraCSSObj.parentNode.removeChild(E.fn.sraCSSObj)}E.returnFocus=false;E.close();E.returnFocus=true}ids.push(D.id)});$A(v,y,l.overrides);$A.query(((l.menuTag||"ul")+"."+(l.menuClass||"menu")+" "+(l.itemTag||"li"))+"."+(l.linkClass||"link"),v.containerDiv,function(C,E){var D=$A.internal.data(E,"isset");if(!D){$A.internal.data(E,"isset",true);$A.bind(E,"menulink",function(F){v.top.close();if(v.handler&&typeof v.handler==="function"){return v.handler.apply(this,[F,v])}});ids.push(E.id)}});if(ids.length){$A.setAttr(v.mNode,"aria-owns",ids.join(" "))}if(v!=v.top&&v.parent&&v.parent.iNodes&&v.triggerObj){$A.setAttr(v.triggerObj,"tabindex","-1")}if(v==v.top){$A.bind("body","focusin.accmenu",function(C){if(v.tempFocus){v.tempFocus=null}else{v.top.close()}});$A.bind(v.accDCObj,"focusin",function(C){v.tempFocus=this})}},n=function(v){if(v.children.length){for(var w=0;w<v.children.length;w++){v.children[w].close()}}if(v.iNodes&&v.iNodes.length){$A.unbind(v.iNodes,"click keypress keydown popupsubmenu menulink")}if(v!=v.top&&v.parent&&v.parent.iNodes&&v.triggerObj){$A.setAttr(v.triggerObj,"tabindex","0")}if(v==v.top){$A.unbind("body","focusin.accmenu")}},o=function(){$A.query((l.menuTag||"ul")+"."+(l.menuClass||"menu"),q,function(w,x){d[x.id]=x.parentNode.removeChild(x)||d[x.id]});if($A.reg[i]){var v=$A.reg[i];if(v.fn.sraCSSObj){v.fn.sraCSSObj.parentNode.removeChild(v.fn.sraCSSObj)}v.returnFocus=false;v.close();v.returnFocus=true}$A([{id:i,role:l.role||"Menu",accStart:l.accStart||"",accEnd:l.accEnd||"",controlType:"MenuControl",bind:"popupmenu",trigger:k,handler:t,topLvlId:i,source:d[i],autoPosition:isNaN(l.autoPosition)?3:l.autoPosition,isStatic:"body",append:true,click:function(x,w){c.pass=true},runBefore:function(w){$A.find("*",function(x){if(x.controlType&&x.controlType=="MenuControl"&&x.loaded){x.close()}});w.offsetLeft=typeof l.offsetLeft==="number"?l.offsetLeft:(typeof l.offsetLeft==="function"?l.offsetLeft(w):(!l.horizontal&&w.parent?-(w.parent.accDCObj.offsetWidth/2):0));w.offsetTop=typeof l.offsetTop==="number"?l.offsetTop:(typeof l.offsetTop==="function"?l.offsetTop(w):(!l.horizontal?-w.triggerObj.offsetHeight:0))},runDuring:function(w){$A.setAttr(w.accDCObj,"role","application");if(w.showHiddenBounds){w.fn.sraStart.innerHTML=w.fn.sraEnd.innerHTML="";$A.setAttr(w.fn.sraStart,"aria-hidden","true");$A.setAttr(w.fn.sraEnd,"aria-hidden","true")}},runAfter:p,runBeforeClose:n,runAfterClose:function(w){c.menuOpen=false},cssObj:{position:(l.overrides&&l.overrides.cssObj&&l.overrides.cssObj.position)||"absolute",zIndex:(l.overrides&&l.overrides.cssObj&&l.overrides.cssObj.zIndex)||1},className:l.containerClass||"menu",ariaLevel:l.ariaLevel||3,tabOut:function(x,w){if(!("ontouchstart" in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){w.top.close()}},allowCascade:true}],l.overrides,true)};if(s){o()}else{$A.load(q,u,o)}if(l.rightClick&&l.rightClickText&&!("ontouchstart" in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){var h="rc"+$A.genId(),m=$A.createEl("div",{id:h,role:"tooltip"},{display:"none"});m.innerHTML=l.rightClickText;document.body.appendChild(m)}if(typeof c!=="function"){c=function(v){if(!c.pass&&!g.pass&&c.menuOpen){if(c.currentMenu&&c.currentMenu.id&&c.currentMenu.loaded){c.currentMenu.close()}}if(c){c.pass=false}if(g){g.pass=false}};c.menuOpen=c.pass=false;$A.bind(document,"click touchstart",c)}if(l.rightClick&&typeof g!=="function"){g=function(v){if(g.pass){v.preventDefault()}g.pass=false};g.pass=false;$A.bind(document,"contextmenu",g)}$A.query(k,j,function(z,w){if(w.nodeName.toLowerCase()!="body"){$A.setAttr(w,"aria-haspopup","true")}if(h){e(w,h)}if(l.rightClick){$A.bind(w,{contextmenu:function(A){A.preventDefault();g.pass=true},mouseup:function(B){var A=-1;if(B.which==null){A=(B.button<2)?1:((B.button==4)?3:2)}else{A=(B.which<2)?1:((B.which==2)?3:2)}if(A==2){g.pass=true;if($A.reg[i].loaded){$A.reg[i].close()}else{$A.trigger(w,"popupmenu")}B.preventDefault()}},keydown:function(B){var A=B.which||B.keyCode;if(A==93||(B.shiftKey&&A==121)){g.pass=true;$A.trigger(w,"popupmenu");B.preventDefault()}}});if("ontouchstart" in window){var v=0,y=0,x=false;$A.bind(w,{touchstart:function(A){v=new Date().getTime()+2000},touchend:function(A){y=new Date().getTime();if(y>v){x=true;A.stopPropagation();A.preventDefault();$A.trigger(w,"popupmenu")}else{x=false}},click:function(A){if(x){x=false;A.stopPropagation();A.preventDefault()}}})}}else{$A.bind(w,{keydown:function(B){var A=B.which||B.keyCode;if(A==40){$A.trigger(w,"popupmenu");B.preventDefault()}},keypress:function(B){var A=B.which||B.keyCode;if(A==13||A==32){$A.trigger(w,"popupmenu");B.preventDefault()}},click:function(A){c.pass=true;if($A.reg[i].loaded){$A.reg[i].close()}else{$A.trigger(w,"popupmenu")}A.preventDefault()}})}$A.bind(w,{closepopupmenu:function(A){if($A.reg[i].loaded){$A.reg[i].close()}}})})};var b=function(o,h,p,i){var m=0,j=[],k=function(q){for(var r=m+1;r<=(n.length-1);r++){if(q.toLowerCase()==j[r].replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase()){m=r;l.apply(n[m]);return}}for(var r=0;r<m;r++){if(q.toLowerCase()==j[r].replace(/^\s+|\s+$/g,"").substring(0,1).toLowerCase()){m=r;l.apply(n[m]);return}}};$A.query(o,p.containerDiv,function(q,r){$A.setAttr(r,"role",p.hor?"menubar":"menu")});var l=function(){var q=this;for(var r=n.length-1;r>=0;r--){if(n[r].id==q.id){m=r}$A.setAttr(n[r],{tabindex:-1})}$A.setAttr(q,{tabindex:"0"}).focus()},n=p.iNodes=$A.query(h,p.containerDiv,function(q,r){j.push($A.getText(r));$A.setAttr(r,{role:"menuitem","aria-posinset":q+1,tabindex:-1});$A.bind(r,{keypress:function(t){var s=t.which||t.keyCode;if(s==27){p.close();t.preventDefault()}else{if(s==13){if($A.hasClass(this,i.folderClass||"submenu")){if($A.getAttr(this,"aria-disabled")!="true"){$A.trigger(this,"popupsubmenu")}else{p.top.close()}}else{$A.trigger(this,"menulink")}t.preventDefault()}}},keydown:function(t){var s=t.which||t.keyCode;if(s>=37&&s<=40){t.preventDefault();if(p!=p.top&&((s==37&&!p.hor)||(s==38&&p.hor))){p.close()}else{if((s==39&&!p.hor)||(s==40&&p.hor)){if($A.hasClass(this,i.folderClass||"submenu")&&$A.getAttr(this,"aria-disabled")!="true"){$A.trigger(this,"popupsubmenu")}}else{if((s==38&&!p.hor)||(s==37&&p.hor)){m=m<=0?n.length-1:m-1}else{if((s==40&&!p.hor)||(s==39&&p.hor)){m=m>=(n.length-1)?0:m+1}}}}if(((s==38||s==40)&&!p.hor)||((s==37||s==39)&&p.hor)){if(!n[m]||n[m].nodeType!==1){m=0}if(n.length){l.apply(n[m])}}}else{if((s>=48&&s<=57)||(s>=65&&s<=90)){k(String.fromCharCode(s));t.preventDefault()}}},click:function(s){if($A.hasClass(this,i.folderClass||"submenu")){if($A.getAttr(this,"aria-disabled")!="true"){$A.trigger(this,"popupsubmenu")}else{p.top.close()}}else{$A.trigger(this,"menulink")}s.preventDefault()}})});$A.query(n,function(q,r){$A.setAttr(r,"aria-setsize",n.length)});l.apply(n[m])},a=function(h){return h.replace(/^\s+|\s+$/g,"")},e=function(m,r){if(!m){return null}var p=$A.isArray(m)?m:[m],k=r.split(" ");for(var j=0;j<p.length;j++){for(var q=0;q<k.length;q++){if(!f(p[j],k[q])){var h=$A.getAttr(p[j],"aria-describedby");if(!h){h=""}$A.setAttr(p[j],"aria-describedby",a(h+" "+k[q]))}}}return m},f=function(m,p){var h=$A.getAttr(m,"aria-describedby");if(!m||!h){return false}var k=p.split(" "),j=0;for(var o=0;o<k.length;o++){if(h.indexOf(k[o])!==-1){j+=1}}if(j===k.length){return true}return false};$A.bind(window,"resize",function(){$A.find("*",function(h){if(h.controlType&&h.controlType=="MenuControl"&&h.loaded){h.close()}})})})();