/*
ARIA Calendar Module R1.0
Copyright 2010-2012 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
*/
(function(){$A.setCalendar=function(f,b,g,h,j){var e=j&&typeof j==="function"?j:function(l,k){g.value=k.range.wDays[k.range.current.wDay].lng+" "+k.range[k.range.current.month].name+" "+k.range.current.mDay+", "+k.range.current.year;k.close()},i={alt:true,ctrl:false,shift:false},d={},c=function(k){d.alt=k.altKey;d.ctrl=k.ctrlKey;d.shift=k.shiftKey};$A([{id:f,role:"Calendar",trigger:b,bind:"click",allowReopen:true,showHiddenClose:h?false:true,tooltipTxt:"Press Escape to cancel",disabledTxt:"Disabled",commentedTxt:"Has Comment",prevTxt:"Previous",nextTxt:"Next",monthTxt:"Month",yearTxt:"Year",autoPosition:9,cssObj:{position:"absolute",zIndex:1},className:"calendar",range:{0:{name:"January",max:31,disabled:{},comments:{}},1:{name:"February",max:28,disabled:{},comments:{}},2:{name:"March",max:31,disabled:{},comments:{}},3:{name:"April",max:30,disabled:{},comments:{}},4:{name:"May",max:31,disabled:{},comments:{}},5:{name:"June",max:30,disabled:{},comments:{}},6:{name:"July",max:31,disabled:{},comments:{}},7:{name:"August",max:31,disabled:{},comments:{}},8:{name:"September",max:30,disabled:{},comments:{}},9:{name:"October",max:31,disabled:{},comments:{}},10:{name:"November",max:30,disabled:{},comments:{}},11:{name:"December",max:31,disabled:{},comments:{}},wDays:[{shrt:"S",lng:"Sunday"},{shrt:"M",lng:"Monday"},{shrt:"T",lng:"Tuesday"},{shrt:"W",lng:"Wednesday"},{shrt:"T",lng:"Thursday"},{shrt:"F",lng:"Friday"},{shrt:"S",lng:"Saturday"}],wdOffset:0},getWDay:function(k,n,l){var n=typeof n==="number"?n:k.range.current.wDay,m=k.range.wdOffset;if(m<0){n=(n+m)<0?7+m:n+m}else{if(m>0){n=(n+m)>6?-1+((n+m)-6):n+m}}if(l){n=6-n}return n},setFocus:function(m,l,k){if(!m){return}this.current=m;$A.query("td.day.selected",this.containerDiv,function(n,o){$A.setAttr(o,{tabindex:"-1","aria-selected":"false"});$A.remClass(o,"selected")});$A.addClass(m,"selected");$A.setAttr(m,{tabindex:"0","aria-selected":"true"});if(!k){m.focus()}},setCurrent:function(k){k.range.current={mDay:k.date.getDate(),month:k.date.getMonth(),year:k.date.getFullYear(),wDay:k.date.getDay()}},runOnceBefore:function(k){k.date=new Date();k.setCurrent(k)},runBefore:function(B){if(B.range.current.month===1){B.range[1].max=(new Date(B.range.current.year,1,29).getMonth()==1)?29:28}B.baseId="b"+$A.genId();B.prevBtnId=B.baseId+"p";B.nextBtnId=B.baseId+"n";B.source='<table role="dialog" class="calendar" aria-label="'+B.role+'"><tr role="presentation"><td class="nav" accesskey="1" title="'+B.prevTxt.replace(/<|>|\"/g,"")+" "+B.yearTxt.replace(/<|>|\"/g,"")+'" role="button" id="'+B.prevBtnId+'Y" tabindex="0"><span>&#8656;</span></td><td title="'+B.tooltipTxt.replace(/<|>|\"/g,"")+'" colspan="5" class="year"><span>'+B.range.current.year+'</span></td><td class="nav" accesskey="2" title="'+B.nextTxt.replace(/<|>|\"/g,"")+" "+B.yearTxt.replace(/<|>|\"/g,"")+'" role="button" id="'+B.nextBtnId+'Y" tabindex="0"><span>&#8658;</span></td></tr><tr role="presentation"><td class="nav" accesskey="3" title="'+B.prevTxt.replace(/<|>|\"/g,"")+" "+B.monthTxt.replace(/<|>|\"/g,"")+'" role="button" id="'+B.prevBtnId+'" tabindex="0"><span>&#8592;</span></td><td colspan="5" class="month"><span>'+B.range[B.range.current.month].name+'</span></td><td class="nav" accesskey="4" title="'+B.nextTxt.replace(/<|>|\"/g,"")+" "+B.monthTxt.replace(/<|>|\"/g,"")+'" role="button" id="'+B.nextBtnId+'" tabindex="0"><span>&#8594;</span></td></tr><tr role="presentation">';var z=B.range.current.month>0?B.range.current.month-1:11,k=B.range.current.month<11?B.range.current.month+1:0;B.iter=0;for(var p=0;p<7;p++){var y=B.getWDay(B,p),x=B.range.wDays[y];if(!p){B.iter=B.iterE=(y+6)>6?-1+y:y+6;B.iterS=y}B.source+='<th class="week" title="'+x.lng+'"><span>'+x.shrt+"</span></th>"}B.source+='</tr><tr role="presentation">';var n=new Date();n.setDate(1);n.setMonth(B.range.current.month);n.setFullYear(B.range.current.year);var t=n.getDay();n.setDate(B.range[B.range.current.month].max);var u=n.getDay(),A=B.iterS;while(A!=t){A=(A+1)>6?0:A+1;B.source+='<td class="empty"><span>&nbsp;</span></td>'}B.range.track={};var o=B.range[B.range.current.month].disabled[B.range.current.year],s=B.range[B.range.current.month].disabled["*"],r=B.range[B.range.current.month].comments[B.range.current.year],q=B.range[B.range.current.month].comments["*"];for(var p=1;p<=B.range[B.range.current.month].max;p++){B.range.track[B.baseId+p]=p;n.setDate(p);var l=(o&&$A.inArray(p,o)!==-1)||(s&&$A.inArray(p,s)!==-1)?true:false,v="";if(r&&r[p]){v=r[p]}else{if(q&&q[p]){v=q[p]}}B.source+='<td aria-label="';if(l){B.source+=B.disabledTxt.replace(/<|>|\"/g,"")+" "}if(v){B.source+=B.commentedTxt.replace(/<|>|\"/g,"")+" "}B.source+=p+", "+B.range.wDays[n.getDay()].lng+" "+B.range[B.range.current.month].name+" "+B.range.current.year;if(v){B.source+=v.replace(/<|>|\n/g," ").replace(/\"/g,'"')}B.source+='" role="link" tabindex="-1" aria-selected="false" class="day';if(l){B.source+=" disabled"}if(v){B.source+=" comment"}B.source+='" title="';if(l){B.source+=B.disabledTxt.replace(/<|>|\"/g,"")}if(v){B.source+=" "+B.commentedTxt.replace(/<|>|\"/g,"")}B.source+='" id="'+B.baseId+p+'"><span>'+p+"</span></td>";n.setDate(p);var A=n.getDay();if(A==B.iter&&p<B.range[B.range.current.month].max){B.source+='</tr><tr role="presentation">'}}while(u!=B.iter){u=(u+1)>6?0:u+1;B.source+='<td class="empty"><span>&nbsp;</span></td>'}B.source+="</tr></table>"},runAfter:function(k){var n=function(){var q=k.range.current.month==11?0:k.range.current.month+1,p=q>0?k.range.current.year:k.range.current.year+1,o=k.range.current.mDay>k.range[q].max?k.range[q].max:k.range.current.mDay;k.date.setDate(o);k.date.setMonth(q);k.date.setFullYear(p);k.setCurrent(k);k.reopen=true;k.open()},l=function(){var q=k.range.current.month<1?11:k.range.current.month-1,p=q<11?k.range.current.year:k.range.current.year-1,o=k.range.current.mDay>k.range[q].max?k.range[q].max:k.range.current.mDay;k.date.setDate(o);k.date.setMonth(q);k.date.setFullYear(p);k.setCurrent(k);k.reopen=true;k.open()},m=function(p){var r=k.range.current.month,q=p?k.range.current.year+1:k.range.current.year-1;if(r===1){k.range[1].max=28}var o=k.range.current.mDay>k.range[r].max?k.range[r].max:k.range.current.mDay;k.date.setDate(o);k.date.setMonth(r);k.date.setFullYear(q);k.setCurrent(k);k.reopen=true;k.open()};$A.bind("td.day",{focus:function(r){if($A.hasClass(this,"comment")){var s=k.children[0],q=k.range[k.range.current.month].comments[k.range.current.year],p=k.range[k.range.current.month].comments["*"],o="";if(q&&q[k.range.current.mDay]){o=q[k.range.current.mDay]}else{if(p&&p[k.range.current.mDay]){o=p[k.range.current.mDay]}}o=a(o.replace(/<|>/g,""));if(o){s.source=o;s.open()}}else{if(k.children[0].loaded){k.children[0].close()}}if(k.children[1].openEditor){k.children[1].openEditor=false;k.children[1].reset()}},click:function(o){k.date.setDate(k.range.track[this.id]);k.setCurrent(k);if($A.hasClass(this,"selected")||(!h&&!$A.hasClass(this,"comment"))){if($A.inArray(k.range.current.mDay,k.range[k.range.current.month].disabled[k.range.current.year]||k.range[k.range.current.month].disabled["*"]||[])===-1){e.apply(this,[o,k])}}else{k.setFocus(this,null,true)}o.preventDefault()},keypress:function(p){var o=p.which||p.keyCode;if(o==13){if($A.inArray(k.range.current.mDay,k.range[k.range.current.month].disabled[k.range.current.year]||k.range[k.range.current.month].disabled["*"]||[])===-1){e.apply(this,[p,k])}p.preventDefault()}else{if(o==32&&h&&!k.children[1].openEditor){k.children[1].openEditor=true;k.children[1].reset();p.preventDefault()}}},keydown:function(q){c(q);var o=q.which||q.keyCode;if((o>=37&&o<=40)||o==27||(o>=33&&o<=36)){var p=k.range.current.wDay;if(o==37){if(p!=k.iterS&&k.range.current.mDay>1){k.range.current.mDay--;k.range.current.wDay=(p-1)<0?6:p-1;k.setFocus(k.range.index[k.range.current.mDay-1],this)}}else{if(o==39){if(p!=k.iterE&&k.range.current.mDay<k.range[k.range.current.month].max){k.range.current.mDay++;k.range.current.wDay=(p+1)>6?0:p+1;k.setFocus(k.range.index[k.range.current.mDay-1],this)}}else{if(o==38){if((k.range.current.mDay-7)>0){k.range.current.mDay-=7;k.setFocus(k.range.index[k.range.current.mDay-1],this)}}else{if(o==40){if((k.range.current.mDay+7)<=k.range[k.range.current.month].max){k.range.current.mDay+=7;k.setFocus(k.range.index[k.range.current.mDay-1],this)}}else{if(o==27){k.close()}else{if(o==33){if(d.alt){m(true)}else{n()}}else{if(o==34){if(d.alt){m()}else{l()}}else{if(o==36){if(p!=k.iterS&&k.range.current.mDay>1){while(k.range.current.wDay!=k.iterS&&$A.getEl(k.baseId+(k.range.current.mDay-1))){k.range.current.wDay=(k.range.current.wDay-1)<0?6:k.range.current.wDay-1;k.range.current.mDay--}k.setFocus(k.range.index[k.range.current.mDay-1],this)}}else{if(o==35){if(p!=k.iterE&&k.range.current.mDay<k.range[k.range.current.month].max){while(k.range.current.wDay!=k.iterE&&$A.getEl(k.baseId+(k.range.current.mDay+1))){k.range.current.wDay=(k.range.current.wDay+1)>6?0:k.range.current.wDay+1;k.range.current.mDay++}k.setFocus(k.range.index[k.range.current.mDay-1],this)}}}}}}}}}}q.preventDefault()}},keyup:function(o){c(o)}});$A.bind("#"+k.prevBtnId,{click:function(o){l();o.preventDefault()},keypress:function(p){var o=p.which||p.keyCode;if(o==13||o==32){l();p.preventDefault()}},keydown:function(p){c(p);var o=p.which||p.keyCode;if(o==27){k.close();p.preventDefault()}},keyup:function(o){c(o)}});$A.bind("#"+k.nextBtnId,{click:function(o){n();o.preventDefault()},keypress:function(p){var o=p.which||p.keyCode;if(o==13||o==32){n();p.preventDefault()}},keydown:function(p){c(p);var o=p.which||p.keyCode;if(o==27){k.close();p.preventDefault()}},keyup:function(o){c(o)}});$A.bind("#"+k.prevBtnId+"Y",{click:function(o){m();o.preventDefault()},keypress:function(p){var o=p.which||p.keyCode;if(o==13||o==32){m();p.preventDefault()}},keydown:function(p){c(p);var o=p.which||p.keyCode;if(o==27){k.close();p.preventDefault()}},keyup:function(o){c(o)}});$A.bind("#"+k.nextBtnId+"Y",{click:function(o){m(true);o.preventDefault()},keypress:function(p){var o=p.which||p.keyCode;if(o==13||o==32){m(true);p.preventDefault()}},keydown:function(p){c(p);var o=p.which||p.keyCode;if(o==27){k.close();p.preventDefault()}},keyup:function(o){c(o)}});k.range.index=$A.query("td.day",k.containerDiv);k.setFocus(k.range.index[k.range.current.mDay-1]);if(h){k.children[1].open()}},tabOut:function(l,k){k.close()},runAfterClose:function(k){if(!k.reopen){k.children[0].close();k.children[1].lock=false;k.children[1].close()}else{k.reopen=false}}}]);$A($A.reg[f],[{id:f+"commentTooltip",role:"Comment",returnFocus:false,showHiddenClose:false,allowReopen:true,autoPosition:1,cssObj:{position:"absolute",zIndex:$A.reg[f].cssObj.zIndex},className:"commentTooltip",runBefore:function(k){k.triggerObj=k.parent.accDCObj}}]);$A($A.reg[f],[{id:f+"commentAdd",role:"Edit Comment",returnFocus:false,allowReopen:true,autoPosition:6,cssObj:{position:"absolute",zIndex:$A.reg[f].cssObj.zIndex},className:"commentAdd",openEditor:false,source:'<textarea style="visibility: hidden; display: none;" class="commentTa" title="Comment"></textarea><button title="Edit Comment" class="commentBtn">Edit</button>',runBefore:function(k){k.triggerObj=k.parent.accDCObj},runDuring:function(k){$A.setAttr(k.accDCObj,{role:"dialog","aria-label":k.role});$A.setAttr(k.containerDiv,"role","presentation")},add:function(k){var l=a(k.textarea.value.replace(/<|>|\n/g," "));if(!k.comments[k.parent.range.current.year]){k.comments[k.parent.range.current.year]={}}k.comments[k.parent.range.current.year][k.parent.range.current.mDay]=l;var m=k.parent.range.current.mDay+", "+k.parent.range.wDays[k.parent.range.current.wDay].lng+" "+k.parent.range[k.parent.range.current.month].name+" "+k.parent.range.current.year,n="";if((k.parent.range[k.parent.range.current.month].disabled[k.parent.range.current.year]&&$A.inArray(k.parent.range.current.mDay,k.parent.range[k.parent.range.current.month].disabled[k.parent.range.current.year])!==-1)||(k.parent.range[k.parent.range.current.month].disabled["*"]&&$A.inArray(k.parent.range.current.mDay,k.parent.range[k.parent.range.current.month].disabled["*"])!==-1)){n+=k.parent.disabledTxt.replace(/<|>|\"/g,"")+" "}if(!l){$A.remClass(k.parent.current,"comment")}else{$A.addClass(k.parent.current,"comment");n+=k.parent.commentedTxt.replace(/<|>|\"/g,"")+" "}m=n+m;$A.setAttr(k.parent.current,{title:a(n),"aria-label":m+" "+l.replace(/\"/g,'"')})},reset:function(){var k=this;if(k.openEditor){k.comments=k.parent.range[k.parent.range.current.month].comments;if(!k.textarea){k.textarea=$A.query("textarea",k.containerDiv,function(){$A.css(this,{visibility:"",display:""});k.css("left",k.parent.accDCObj.offsetLeft);$A.bind(this,{focus:function(l){if(k.parent.children[0].loaded){k.parent.children[0].close()}},keypress:function(m){var l=m.which||m.keyCode;if(this.value.length>800){this.value=this.value.substring(0,799)}if(l==13){k.add.apply(this,[k]);k.parent.current.focus();k.openEditor=false;k.reset();m.preventDefault()}else{if(l==27){k.parent.current.focus();k.openEditor=false;k.reset();m.preventDefault()}}}})})[0]}else{$A.css(k.textarea,{visibility:"",display:""});k.css("left",k.parent.accDCObj.offsetLeft)}$A.setAttr(k.textarea,{title:"Comment for "+k.parent.range.current.mDay+", "+k.parent.range.wDays[k.parent.range.current.wDay].lng+" "+k.parent.range[k.parent.range.current.month].name+" "+k.parent.range.current.year}).focus();if(k.comments[k.parent.range.current.year]&&k.comments[k.parent.range.current.year][k.parent.range.current.mDay]){k.textarea.value=k.comments[k.parent.range.current.year][k.parent.range.current.mDay]}$A.setAttr(k.commentBtn,{title:"Save Comment"}).innerHTML="Save"}else{if(k.textarea){k.textarea.value="";$A.css(k.textarea,{visibility:"hidden",display:"none"})}k.css("left",k.parent.accDCObj.offsetLeft+k.parent.accDCObj.offsetWidth-k.accDCObj.offsetWidth);$A.setAttr(k.commentBtn,{title:"Edit Comment"}).innerHTML="Edit"}},runAfter:function(k){$A.query("button",k.containerDiv,function(){k.commentBtn=this;$A.bind(this,{focus:function(l){if(k.parent.children[0].loaded){k.parent.children[0].close()}},click:function(l){if(k.openEditor){k.add.apply(this,[k]);k.parent.current.focus();k.openEditor=false;k.reset()}else{k.openEditor=true;k.reset()}l.preventDefault()},keypress:function(m){var l=m.which||m.keyCode;if(l==27){if(k.openEditor){k.parent.current.focus();k.openEditor=false;k.reset()}else{k.parent.close()}m.preventDefault()}}})});k.reset();k.lock=true},tabOut:function(l,k){k.parent.close()},runBeforeClose:function(k){k.openEditor=false;k.textarea=null}}])};var a=function(b){return b.replace(/^\s+|\s+$/g,"")}})();