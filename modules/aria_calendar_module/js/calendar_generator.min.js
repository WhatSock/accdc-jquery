/*
ARIA Calendar Module R1.3
Copyright 2010-2013 Bryan Garaventa (WhatSock.com)
Part of AccDC, a Cross-Browser JavaScript accessibility API, distributed under the terms of the Open Source Initiative OSI - MIT License
*/
(function(){$A.setCalendar=function(g,b,h,i,k,c){var c=c||{},f=k&&typeof k==="function"?k:function(m,l){h.value=l.range.wDays[l.range.current.wDay].lng+" "+l.range[l.range.current.month].name+" "+l.range.current.mDay+", "+l.range.current.year;l.close()},j={alt:true,ctrl:false,shift:false},e={},d=function(l){e.alt=l.altKey;e.ctrl=l.ctrlKey;e.shift=l.shiftKey};$A([{id:g,role:c.role||"Calendar",accStart:c.accStart||"Start",accEnd:c.accEnd||"End",trigger:b,bind:"click",allowReopen:true,showHiddenClose:i&&c.editor&&c.editor.show?false:true,controlType:"DatePicker",tooltipTxt:c.tooltipTxt||"Press Escape to cancel",disabledTxt:c.disabledTxt||"Disabled",commentedTxt:c.commentedTxt||"Has Comment",prevTxt:c.prevTxt||"Previous",nextTxt:c.nextTxt||"Next",monthTxt:c.monthTxt||"Month",yearTxt:c.yearTxt||"Year",autoPosition:isNaN(c.autoPosition)?9:c.autoPosition,offsetTop:isNaN(c.offsetTop)?0:c.offsetTop,offsetLeft:isNaN(c.offsetLeft)?0:c.offsetLeft,posAnchor:c.posAnchor,cssObj:{position:"absolute",zIndex:1},className:c.className||"calendar",range:{0:{name:c.months&&c.months[0]?c.months[0]:"January",max:31,disabled:{},comments:{}},1:{name:c.months&&c.months[1]?c.months[1]:"February",max:28,disabled:{},comments:{}},2:{name:c.months&&c.months[2]?c.months[2]:"March",max:31,disabled:{},comments:{}},3:{name:c.months&&c.months[3]?c.months[3]:"April",max:30,disabled:{},comments:{}},4:{name:c.months&&c.months[4]?c.months[4]:"May",max:31,disabled:{},comments:{}},5:{name:c.months&&c.months[5]?c.months[5]:"June",max:30,disabled:{},comments:{}},6:{name:c.months&&c.months[6]?c.months[6]:"July",max:31,disabled:{},comments:{}},7:{name:c.months&&c.months[7]?c.months[7]:"August",max:31,disabled:{},comments:{}},8:{name:c.months&&c.months[8]?c.months[8]:"September",max:30,disabled:{},comments:{}},9:{name:c.months&&c.months[9]?c.months[9]:"October",max:31,disabled:{},comments:{}},10:{name:c.months&&c.months[10]?c.months[10]:"November",max:30,disabled:{},comments:{}},11:{name:c.months&&c.months[11]?c.months[11]:"December",max:31,disabled:{},comments:{}},wDays:[{shrt:c.days&&c.days[0]?c.days[0].s:"S",lng:c.days&&c.days[0]?c.days[0].l:"Sunday"},{shrt:c.days&&c.days[1]?c.days[1].s:"M",lng:c.days&&c.days[1]?c.days[1].l:"Monday"},{shrt:c.days&&c.days[2]?c.days[2].s:"T",lng:c.days&&c.days[2]?c.days[2].l:"Tuesday"},{shrt:c.days&&c.days[3]?c.days[3].s:"W",lng:c.days&&c.days[3]?c.days[3].l:"Wednesday"},{shrt:c.days&&c.days[4]?c.days[4].s:"T",lng:c.days&&c.days[4]?c.days[4].l:"Thursday"},{shrt:c.days&&c.days[5]?c.days[5].s:"F",lng:c.days&&c.days[5]?c.days[5].l:"Friday"},{shrt:c.days&&c.days[6]?c.days[6].s:"S",lng:c.days&&c.days[6]?c.days[6].l:"Saturday"}],wdOffset:isNaN(c.wdOffset)?0:c.wdOffset},getWDay:function(l,p,m){var p=typeof p==="number"?p:l.range.current.wDay,n=l.range.wdOffset;if(n<0){p=(p+n)<0?7+n:p+n}else{if(n>0){p=(p+n)>6?-1+((p+n)-6):p+n}}if(m){p=6-p}return p},setFocus:function(n,m,l){if(!n){return}this.current=n;$A.query("td.day.selected",this.containerDiv,function(o,q){$A.setAttr(q,{tabindex:"-1","aria-selected":"false"});$A.remClass(q,"selected")});$A.addClass(n,"selected");$A.setAttr(n,{tabindex:"0","aria-selected":"true"});if(!l){n.focus()}},setCurrent:function(l){l.range.current={mDay:l.date.getDate(),month:l.date.getMonth(),year:l.date.getFullYear(),wDay:l.date.getDay()}},runOnceBefore:function(l){l.date=new Date();l.setCurrent(l)},runBefore:function(C){if(c.ajax&&typeof c.ajax==="function"&&!C.stopAjax&&!C.ajaxLoading){C.ajaxLoading=C.cancel=true;c.ajax.apply(C,[C,false])}if(C.range.current.month===1){C.range[1].max=(new Date(C.range.current.year,1,29).getMonth()==1)?29:28}C.baseId="b"+$A.genId();C.prevBtnId=C.baseId+"p";C.nextBtnId=C.baseId+"n";C.source='<table role="application" class="calendar" aria-label="'+C.role+'"><tr role="presentation"><td class="nav" accesskey="1" title="'+C.prevTxt.replace(/<|>|\"/g,"")+" "+C.yearTxt.replace(/<|>|\"/g,"")+'" role="button" id="'+C.prevBtnId+'Y" tabindex="0"><span>&#8656;</span></td><td title="'+C.tooltipTxt.replace(/<|>|\"/g,"")+'" colspan="5" class="year"><span>'+C.range.current.year+'</span></td><td class="nav" accesskey="2" title="'+C.nextTxt.replace(/<|>|\"/g,"")+" "+C.yearTxt.replace(/<|>|\"/g,"")+'" role="button" id="'+C.nextBtnId+'Y" tabindex="0"><span>&#8658;</span></td></tr><tr role="presentation"><td class="nav" accesskey="3" title="'+C.prevTxt.replace(/<|>|\"/g,"")+" "+C.monthTxt.replace(/<|>|\"/g,"")+'" role="button" id="'+C.prevBtnId+'" tabindex="0"><span>&#8592;</span></td><td colspan="5" class="month"><span>'+C.range[C.range.current.month].name+'</span></td><td class="nav" accesskey="4" title="'+C.nextTxt.replace(/<|>|\"/g,"")+" "+C.monthTxt.replace(/<|>|\"/g,"")+'" role="button" id="'+C.nextBtnId+'" tabindex="0"><span>&#8594;</span></td></tr><tr role="presentation">';var A=C.range.current.month>0?C.range.current.month-1:11,l=C.range.current.month<11?C.range.current.month+1:0;C.iter=0;for(var q=0;q<7;q++){var z=C.getWDay(C,q),y=C.range.wDays[z];if(!q){C.iter=C.iterE=(z+6)>6?-1+z:z+6;C.iterS=z}C.source+='<th class="week" title="'+y.lng+'"><span>'+y.shrt+"</span></th>"}C.source+='</tr><tr role="presentation">';var o=new Date();o.setDate(1);o.setMonth(C.range.current.month);o.setFullYear(C.range.current.year);var u=o.getDay();o.setDate(C.range[C.range.current.month].max);var v=o.getDay(),B=C.iterS;while(B!=u){B=(B+1)>6?0:B+1;C.source+='<td class="empty"><span>&nbsp;</span></td>'}C.range.track={};var p=C.range[C.range.current.month].disabled[C.range.current.year],t=C.range[C.range.current.month].disabled["*"],s=C.range[C.range.current.month].comments[C.range.current.year],r=C.range[C.range.current.month].comments["*"];for(var q=1;q<=C.range[C.range.current.month].max;q++){C.range.track[C.baseId+q]=q;o.setDate(q);var n=(p&&$A.inArray(q,p)!==-1)||(t&&$A.inArray(q,t)!==-1)?true:false,x="";if(s&&s[q]){x=s[q]}else{if(r&&r[q]){x=r[q]}}C.source+='<td aria-label="';if(n){C.source+=C.disabledTxt.replace(/<|>|\"/g,"")+" "}if(x){C.source+=C.commentedTxt.replace(/<|>|\"/g,"")+" "}C.source+=q+", "+C.range.wDays[o.getDay()].lng+" "+C.range[C.range.current.month].name+" "+C.range.current.year;if(x){C.source+=x.replace(/<|>|\n/g," ").replace(/\"/g,'"')}C.source+='" role="link" tabindex="-1" aria-selected="false" class="day';if(n){C.source+=" disabled"}if(x){C.source+=" comment"}C.source+='" title="';if(n){C.source+=C.disabledTxt.replace(/<|>|\"/g,"")}if(x){C.source+=" "+C.commentedTxt.replace(/<|>|\"/g,"")}C.source+='" id="'+C.baseId+q+'"><span>'+q+"</span></td>";o.setDate(q);var B=o.getDay();if(B==C.iter&&q<C.range[C.range.current.month].max){C.source+='</tr><tr role="presentation">'}}while(v!=C.iter){v=(v+1)>6?0:v+1;C.source+='<td class="empty"><span>&nbsp;</span></td>'}C.source+="</tr></table>";$A.find("*",function(m){if(m.controlType&&m.controlType=="DatePicker"&&m.loaded){m.close()}})},runDuring:function(l){$A.setAttr(l.accDCObj,{role:"dialog","aria-label":l.role})},runAfter:function(l){var o=function(){var r=l.range.current.month==11?0:l.range.current.month+1,q=r>0?l.range.current.year:l.range.current.year+1,p=l.range.current.mDay>l.range[r].max?l.range[r].max:l.range.current.mDay;l.date=new Date(q,r,p);l.setCurrent(l);l.reopen=true;l.open()},m=function(){var r=l.range.current.month<1?11:l.range.current.month-1,q=r<11?l.range.current.year:l.range.current.year-1,p=l.range.current.mDay>l.range[r].max?l.range[r].max:l.range.current.mDay;l.date=new Date(q,r,p);l.setCurrent(l);l.reopen=true;l.open()},n=function(q){var s=l.range.current.month,r=q?l.range.current.year+1:l.range.current.year-1;if(s===1){l.range[1].max=28}var p=l.range.current.mDay>l.range[s].max?l.range[s].max:l.range.current.mDay;l.date=new Date(r,s,p);l.setCurrent(l);l.reopen=true;l.open()};$A.bind("td.day",{focus:function(s){if($A.hasClass(this,"comment")){var t=l.children[0],r=l.range[l.range.current.month].comments[l.range.current.year],q=l.range[l.range.current.month].comments["*"],p="";if(r&&r[l.range.current.mDay]){p=r[l.range.current.mDay]}else{if(q&&q[l.range.current.mDay]){p=q[l.range.current.mDay]}}p=a(p.replace(/<|>/g,""));if(p){t.source=p;t.open()}}else{if(l.children[0].loaded){l.children[0].close()}}if(l.children[1].openEditor){l.children[1].openEditor=false;l.children[1].reset()}},click:function(p){l.date.setDate(l.range.track[this.id]);l.setCurrent(l);if($A.hasClass(this,"selected")||(!i&&!$A.hasClass(this,"comment"))){if($A.inArray(l.range.current.mDay,l.range[l.range.current.month].disabled[l.range.current.year]||l.range[l.range.current.month].disabled["*"]||[])===-1){f.apply(this,[p,l,h])}}else{l.setFocus(this,null,true)}p.preventDefault()},keypress:function(q){var p=q.which||q.keyCode;if(p==13){if($A.inArray(l.range.current.mDay,l.range[l.range.current.month].disabled[l.range.current.year]||l.range[l.range.current.month].disabled["*"]||[])===-1){f.apply(this,[q,l,h])}q.preventDefault()}else{if(p==32&&i&&c.editor&&c.editor.show&&!l.children[1].openEditor){l.children[1].openEditor=true;l.children[1].reset();q.preventDefault()}}},keydown:function(t){d(t);var q=t.which||t.keyCode;if((q>=37&&q<=40)||q==27||(q>=33&&q<=36)){var s=l.range.current.wDay;if(q==37){if(s!=l.iterS&&l.range.current.mDay>1){l.range.current.mDay--;l.range.current.wDay=(s-1)<0?6:s-1;l.setFocus(l.range.index[l.range.current.mDay-1],this)}else{if(s!=l.iterS&&l.range.current.mDay==1&&s>0){var u=l.range.current.month<1?11:l.range.current.month-1,r=u<11?l.range.current.year:l.range.current.year-1,p=l.range[u].max;if(u===1){p=(new Date(r,1,29).getMonth()==1)?29:28}l.date=new Date(r,u,p);l.setCurrent(l);l.reopen=true;l.open()}}}else{if(q==39){if(s!=l.iterE&&l.range.current.mDay<l.range[l.range.current.month].max){l.range.current.mDay++;l.range.current.wDay=(s+1)>6?0:s+1;l.setFocus(l.range.index[l.range.current.mDay-1],this)}else{if(s!=l.iterE&&l.range.current.mDay==l.range[l.range.current.month].max&&s<6){var u=l.range.current.month==11?0:l.range.current.month+1,r=u>0?l.range.current.year:l.range.current.year+1;l.date=new Date(r,u,1);l.setCurrent(l);l.reopen=true;l.open()}}}else{if(q==38){if((l.range.current.mDay-7)>0){l.range.current.mDay-=7;l.setFocus(l.range.index[l.range.current.mDay-1],this)}else{var u=l.range.current.month<1?11:l.range.current.month-1,r=u<11?l.range.current.year:l.range.current.year-1;if(u===1&&(new Date(r,1,29).getMonth()==1)){l.range[u].max=29}else{if(u===1){l.range[u].max=28}}var p=l.range[u].max+(l.range.current.mDay-7);l.date=new Date(r,u,p);l.setCurrent(l);l.reopen=true;l.open()}}else{if(q==40){if((l.range.current.mDay+7)<=l.range[l.range.current.month].max){l.range.current.mDay+=7;l.setFocus(l.range.index[l.range.current.mDay-1],this)}else{var u=l.range.current.month==11?0:l.range.current.month+1,r=u>0?l.range.current.year:l.range.current.year+1,p=l.range.current.mDay+7-l.range[l.range.current.month].max;l.date=new Date(r,u,p);l.setCurrent(l);l.reopen=true;l.open()}}else{if(q==27){l.close()}else{if(q==33){if(e.alt){n(true)}else{o()}}else{if(q==34){if(e.alt){n()}else{m()}}else{if(q==36){if(s!=l.iterS&&l.range.current.mDay>1){while(l.range.current.wDay!=l.iterS&&$A.getEl(l.baseId+(l.range.current.mDay-1))){l.range.current.wDay=(l.range.current.wDay-1)<0?6:l.range.current.wDay-1;l.range.current.mDay--}l.setFocus(l.range.index[l.range.current.mDay-1],this)}}else{if(q==35){if(s!=l.iterE&&l.range.current.mDay<l.range[l.range.current.month].max){while(l.range.current.wDay!=l.iterE&&$A.getEl(l.baseId+(l.range.current.mDay+1))){l.range.current.wDay=(l.range.current.wDay+1)>6?0:l.range.current.wDay+1;l.range.current.mDay++}l.setFocus(l.range.index[l.range.current.mDay-1],this)}}}}}}}}}}t.preventDefault()}},keyup:function(p){d(p)}});$A.bind("#"+l.prevBtnId,{click:function(p){m();p.preventDefault()},keypress:function(q){var p=q.which||q.keyCode;if(p==13||p==32){m();q.preventDefault()}},keydown:function(q){d(q);var p=q.which||q.keyCode;if(p==27){l.close();q.preventDefault()}},keyup:function(p){d(p)}});$A.bind("#"+l.nextBtnId,{click:function(p){o();p.preventDefault()},keypress:function(q){var p=q.which||q.keyCode;if(p==13||p==32){o();q.preventDefault()}},keydown:function(q){d(q);var p=q.which||q.keyCode;if(p==27){l.close();q.preventDefault()}},keyup:function(p){d(p)}});$A.bind("#"+l.prevBtnId+"Y",{click:function(p){n();p.preventDefault()},keypress:function(q){var p=q.which||q.keyCode;if(p==13||p==32){n();q.preventDefault()}},keydown:function(q){d(q);var p=q.which||q.keyCode;if(p==27){l.close();q.preventDefault()}},keyup:function(p){d(p)}});$A.bind("#"+l.nextBtnId+"Y",{click:function(p){n(true);p.preventDefault()},keypress:function(q){var p=q.which||q.keyCode;if(p==13||p==32){n(true);q.preventDefault()}},keydown:function(q){d(q);var p=q.which||q.keyCode;if(p==27){l.close();q.preventDefault()}},keyup:function(p){d(p)}});l.range.index=$A.query("td.day",l.containerDiv);l.setFocus(l.range.index[l.range.current.mDay-1]);if(i&&c.editor&&c.editor.show){l.children[1].open()}},tabOut:function(m,l){l.close()},runAfterClose:function(l){if(!l.reopen){if(i){l.children[0].close()}if(i&&c.editor&&c.editor.show){l.children[1].lock=false;l.children[1].close()}}else{l.reopen=false}if(c.ajax&&typeof c.ajax==="function"){l.lock=l.ajaxLoading=false}}}]);$A($A.reg[g],[{id:g+"commentTooltip",role:c.comments&&c.comments.role||"Comment",accStart:c.accStart||"Start",accEnd:c.accEnd||"End",returnFocus:false,showHiddenClose:false,allowReopen:true,autoPosition:isNaN(c.comments&&c.comments.autoPosition)?1:c.comments.autoPosition,offsetTop:isNaN(c.comments&&c.comments.offsetTop)?0:c.comments.offsetTop,offsetLeft:isNaN(c.comments&&c.comments.offsetLeft)?0:c.comments.offsetLeft,cssObj:{position:"absolute",zIndex:$A.reg[g].cssObj.zIndex},className:c.comments&&c.comments.className||"commentTooltip",runBefore:function(l){l.triggerObj=l.parent.accDCObj}}]);$A($A.reg[g],[{id:g+"commentAdd",role:c.editor&&c.editor.role||"Edit",accStart:c.accStart||"Start",accEnd:c.accEnd||"End",returnFocus:false,allowReopen:true,autoPosition:isNaN(c.editor&&c.editor.autoPosition)?6:c.editor.autoPosition,offsetTop:isNaN(c.editor&&c.editor.offsetTop)?0:c.editor.offsetTop,offsetLeft:isNaN(c.editor&&c.editor.offsetLeft)?0:c.editor.offsetLeft,cssObj:{position:"absolute",zIndex:$A.reg[g].cssObj.zIndex},className:c.editor&&c.editor.className||"commentAdd",openEditor:false,source:'<textarea style="visibility: hidden; display: none;" class="commentTa" title="'+$A.reg[g+"commentTooltip"].role+'"></textarea><button title="'+(c.editor&&c.editor.role||"Edit")+" "+$A.reg[g+"commentTooltip"].role+'" class="commentBtn">'+(c.editor&&c.editor.role||"Edit")+"</button>",runBefore:function(l){l.triggerObj=l.parent.accDCObj},runDuring:function(l){$A.setAttr(l.accDCObj,{role:"dialog","aria-label":l.role});$A.setAttr(l.containerDiv,"role","application")},add:function(l){var m=a(l.textarea.value.replace(/<|>|\n/g," "));if(!l.comments[l.parent.range.current.year]){l.comments[l.parent.range.current.year]={}}l.comments[l.parent.range.current.year][l.parent.range.current.mDay]=m;var n=l.parent.range.current.mDay+", "+l.parent.range.wDays[l.parent.range.current.wDay].lng+" "+l.parent.range[l.parent.range.current.month].name+" "+l.parent.range.current.year,o="";if((l.parent.range[l.parent.range.current.month].disabled[l.parent.range.current.year]&&$A.inArray(l.parent.range.current.mDay,l.parent.range[l.parent.range.current.month].disabled[l.parent.range.current.year])!==-1)||(l.parent.range[l.parent.range.current.month].disabled["*"]&&$A.inArray(l.parent.range.current.mDay,l.parent.range[l.parent.range.current.month].disabled["*"])!==-1)){o+=l.parent.disabledTxt.replace(/<|>|\"/g,"")+" "}if(!m){$A.remClass(l.parent.current,"comment")}else{$A.addClass(l.parent.current,"comment");o+=l.parent.commentedTxt.replace(/<|>|\"/g,"")+" "}n=o+n;$A.setAttr(l.parent.current,{title:a(o),"aria-label":n+" "+m.replace(/\"/g,'"')})},reset:function(){var l=this;if(l.openEditor){l.comments=l.parent.range[l.parent.range.current.month].comments;if(!l.textarea){l.textarea=$A.query("textarea",l.containerDiv,function(){$A.css(this,{visibility:"",display:""});l.css("left",l.parent.accDCObj.offsetLeft);$A.bind(this,{focus:function(m){if(l.parent.children[0].loaded){l.parent.children[0].close()}},keypress:function(n){var m=n.which||n.keyCode;if(this.value.length>800){this.value=this.value.substring(0,799)}if(m==13){l.add.apply(this,[l]);l.parent.current.focus();l.openEditor=false;l.reset();n.preventDefault()}else{if(m==27){l.parent.current.focus();l.openEditor=false;l.reset();n.preventDefault()}}}})})[0]}else{$A.css(l.textarea,{visibility:"",display:""});l.css("left",l.parent.accDCObj.offsetLeft)}$A.setAttr(l.textarea,{title:l.parent.range.current.mDay+", "+l.parent.range.wDays[l.parent.range.current.wDay].lng+" "+l.parent.range[l.parent.range.current.month].name+" "+l.parent.range.current.year}).focus();if(l.comments[l.parent.range.current.year]&&l.comments[l.parent.range.current.year][l.parent.range.current.mDay]){l.textarea.value=l.comments[l.parent.range.current.year][l.parent.range.current.mDay]}$A.setAttr(l.commentBtn,{title:(c.editor&&c.editor.action1||"Save")+" "+$A.reg[g+"commentTooltip"].role}).innerHTML=c.editor&&c.editor.action1||"Save"}else{if(l.textarea){l.textarea.value="";$A.css(l.textarea,{visibility:"hidden",display:"none"})}l.css("left",l.parent.accDCObj.offsetLeft+l.parent.accDCObj.offsetWidth-l.accDCObj.offsetWidth);$A.setAttr(l.commentBtn,{title:(c.editor&&c.editor.role||"Edit")+" "+$A.reg[g+"commentTooltip"].role}).innerHTML=c.editor&&c.editor.role||"Edit"}},runAfter:function(l){$A.query("button",l.containerDiv,function(){l.commentBtn=this;$A.bind(this,{focus:function(m){if(l.parent.children[0].loaded){l.parent.children[0].close()}},click:function(m){if(l.openEditor){l.add.apply(this,[l]);l.parent.current.focus();l.openEditor=false;l.reset()}else{l.openEditor=true;l.reset()}m.preventDefault()},keypress:function(n){var m=n.which||n.keyCode;if(m==27){if(l.openEditor){l.parent.current.focus();l.openEditor=false;l.reset()}else{l.parent.close()}n.preventDefault()}}})});l.reset();l.lock=true},tabOut:function(m,l){l.parent.close()},runBeforeClose:function(l){l.openEditor=false;l.textarea=null;if(c.ajax&&typeof c.ajax==="function"){c.ajax.apply(l.parent,[l.parent,true])}},lock:i&&c.editor&&c.editor.show?false:true}])};var a=function(b){return b.replace(/^\s+|\s+$/g,"")}})();